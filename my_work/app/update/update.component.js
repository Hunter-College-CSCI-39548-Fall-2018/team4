"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var sqlite_service_1 = require("../database/sqlite.service");
var router_1 = require("nativescript-angular/router");
var shared_1 = require("../shared");
var application_settings_1 = require("application-settings");
var dialogs = require("tns-core-modules/ui/dialogs");
var UpdateComponent = /** @class */ (function () {
    function UpdateComponent(routerExtensions, userService, database) {
        this.routerExtensions = routerExtensions;
        this.userService = userService;
        this.database = database;
        this.infoMetro = [];
        this.layoutWidth = 400;
        this.layoutHeight = 300;
        this.user_id = application_settings_1.getString("user_id");
    }
    UpdateComponent.prototype.ngOnInit = function () {
        this.selectCard();
    };
    UpdateComponent.prototype.selectCard = function () {
        var _this = this;
        this.infoMetro = [];
        this.database.getdbConnection().then(function (db) {
            db.all("SELECT * FROM metrocard WHERE user_id = ?", [_this.user_id])
                .then(function (rows) {
                for (var row in rows) {
                    _this.infoMetro.push({ id: rows[row][0], type: rows[row][1], date: rows[row][2], amount: rows[row][3], expiration: rows[row][4] });
                }
                _this.db = db;
            }, function (error) {
                console.log("SELECT ERROR", error);
            });
        });
    };
    UpdateComponent.prototype.onItemTap = function (args) {
        var _this = this;
        //args.index
        console.log(args.index);
        dialogs.action({
            title: "Are you sure you want to Update this?",
            message: "Once updated, it cannot be changed ",
            actions: ["REMOVE $2.75", "ADDED $2.75", "REMOVE $5.50", "ADDED $5.50"],
            cancelButtonText: "Cancel",
        }).then(function (result) {
            if (result == "REMOVE $2.75") {
                console.log("Updating card");
                //Delete Card here.
                var metrocard_1 = args.view.bindingContext;
                _this.db.execSQL("UPDATE metrocard SET total_amount = total_amount-2.75 WHERE id=?", [metrocard_1.id]).then(function () {
                    var index = _this.infoMetro.indexOf(metrocard_1);
                    console.log("Object that triggered the event: " + args.object);
                    console.log("View that triggered the event: " + args.view);
                    console.log("Event name: " + args.eventName);
                });
                _this.routerExtensions.navigate(["/home"], { clearHistory: true });
            }
            else if (result == "ADDED $2.75") {
                var metrocard_2 = args.view.bindingContext;
                _this.db.execSQL("UPDATE metrocard SET total_amount = total_amount+2.75 WHERE id=?", [metrocard_2.id]).then(function () {
                    var index = _this.infoMetro.indexOf(metrocard_2);
                    console.log("Object that triggered the event: " + args.object);
                    console.log("View that triggered the event: " + args.view);
                    console.log("Event name: " + args.eventName);
                });
                _this.routerExtensions.navigate(["/home"], { clearHistory: true });
            }
            else if (result == "ADDED $5.50") {
                var metrocard_3 = args.view.bindingContext;
                _this.db.execSQL("UPDATE metrocard SET total_amount = total_amount+5.50 WHERE id=?", [metrocard_3.id]).then(function () {
                    var index = _this.infoMetro.indexOf(metrocard_3);
                    console.log("Object that triggered the event: " + args.object);
                    console.log("View that triggered the event: " + args.view);
                    console.log("Event name: " + args.eventName);
                });
                _this.routerExtensions.navigate(["/home"], { clearHistory: true });
            }
            else if (result == "REMOVE $5.50") {
                var metrocard_4 = args.view.bindingContext;
                _this.db.execSQL("UPDATE metrocard SET total_amount = total_amount-5.50 WHERE id=?", [metrocard_4.id]).then(function () {
                    var index = _this.infoMetro.indexOf(metrocard_4);
                    console.log("Object that triggered the event: " + args.object);
                    console.log("View that triggered the event: " + args.view);
                    console.log("Event name: " + args.eventName);
                });
                _this.routerExtensions.navigate(["/home"], { clearHistory: true });
            }
            else {
                shared_1.alert('Nothing has changed');
                _this.routerExtensions.navigate(["/home"], { clearHistory: true });
            }
        });
    };
    UpdateComponent = __decorate([
        core_1.Component({
            selector: "Update",
            moduleId: module.id,
            templateUrl: "./update.component.html"
        }),
        __metadata("design:paramtypes", [router_1.RouterExtensions,
            shared_1.LoginService,
            sqlite_service_1.DatabaseService])
    ], UpdateComponent);
    return UpdateComponent;
}());
exports.UpdateComponent = UpdateComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBkYXRlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInVwZGF0ZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFFQSxzQ0FBa0Q7QUFDbEQsNkRBQTZEO0FBQzdELHNEQUErRDtBQUMvRCxvQ0FBc0Q7QUFDdEQsNkRBQWlEO0FBQ2pELHFEQUF1RDtBQWF2RDtJQWNJLHlCQUNZLGdCQUFrQyxFQUNsQyxXQUF5QixFQUN6QixRQUF5QjtRQUZ6QixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ2xDLGdCQUFXLEdBQVgsV0FBVyxDQUFjO1FBQ3pCLGFBQVEsR0FBUixRQUFRLENBQWlCO1FBZnJDLGNBQVMsR0FBa0IsRUFBRSxDQUFDO1FBUzlCLGdCQUFXLEdBQVcsR0FBRyxDQUFDO1FBQzFCLGlCQUFZLEdBQVcsR0FBRyxDQUFDO1FBT3ZCLElBQUksQ0FBQyxPQUFPLEdBQUcsZ0NBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRUQsa0NBQVEsR0FBUjtRQUNJLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUN0QixDQUFDO0lBRUQsb0NBQVUsR0FBVjtRQUFBLGlCQWdCQztRQWZHLElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO1FBQ3BCLElBQUksQ0FBQyxRQUFRLENBQUMsZUFBZSxFQUFFLENBQUMsSUFBSSxDQUNoQyxVQUFBLEVBQUU7WUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLDJDQUEyQyxFQUFDLENBQUMsS0FBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2lCQUM3RSxJQUFJLENBQUUsVUFBQSxJQUFJO2dCQUNQLEdBQUcsQ0FBQSxDQUFDLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxDQUFBLENBQUM7b0JBQ2pCLEtBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJ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QUksS0FBSyxHQUFHLEtBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFdBQVMsQ0FBQyxDQUFDO29CQUc5QyxPQUFPLENBQUMsR0FBRyxDQUFDLG1DQUFtQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztvQkFDL0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQ0FBaUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7b0JBQzNELE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFHL0MsQ0FBQyxDQUFDLENBQUM7Z0JBQ0gsS0FBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7WUFDdEUsQ0FBQztZQUVELElBQUksQ0FBQSxDQUFDO2dCQUNELGNBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUFBO2dCQUM1QixLQUFJLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUN0RSxDQUFDO1FBRUwsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBekhRLGVBQWU7UUFMM0IsZ0JBQVMsQ0FBQztZQUNQLFFBQVEsRUFBRSxRQUFRO1lBQ2xCLFFBQVEsRUFBRSxNQUFNLENBQUMsRUFBRTtZQUNuQixXQUFXLEVBQUUseUJBQXlCO1NBQ3pDLENBQUM7eUNBZ0JnQyx5QkFBZ0I7WUFDckIscUJBQVk7WUFDZixnQ0FBZTtPQWpCNUIsZUFBZSxDQTRIM0I7SUFBRCxzQkFBQztDQUFBLEFBNUhELElBNEhDO0FBNUhZLDBDQUFlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVmlld0NoaWxkIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IFJhZFNpZGVEcmF3ZXJDb21wb25lbnQsIFNpZGVEcmF3ZXJUeXBlIH0gZnJvbSBcIm5hdGl2ZXNjcmlwdC11aS1zaWRlZHJhd2VyL2FuZ3VsYXJcIjtcbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IERhdGFiYXNlU2VydmljZSB9IGZyb20gXCIuLi9kYXRhYmFzZS9zcWxpdGUuc2VydmljZVwiO1xuaW1wb3J0IHsgUm91dGVyRXh0ZW5zaW9ucyB9IGZyb20gXCJuYXRpdmVzY3JpcHQtYW5ndWxhci9yb3V0ZXJcIjtcbmltcG9ydCB7IGFsZXJ0LCBMb2dpblNlcnZpY2UsIFVzZXIgfSBmcm9tIFwiLi4vc2hhcmVkXCI7XG5pbXBvcnQgeyBnZXRTdHJpbmcgfSBmcm9tIFwiYXBwbGljYXRpb24tc2V0dGluZ3NcIjtcbmltcG9ydCAqIGFzIGRpYWxvZ3MgZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvdWkvZGlhbG9nc1wiO1xuaW1wb3J0IHsgR2VzdHVyZUV2ZW50RGF0YSB9IGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL3VpL2dlc3R1cmVzXCI7XG5pbXBvcnQgeyBMaXN0Vmlld0V2ZW50RGF0YSwgUmFkTGlzdFZpZXcgfSBmcm9tIFwibmF0aXZlc2NyaXB0LXVpLWxpc3R2aWV3XCI7XG5pbXBvcnQgeyBWaWV3IH0gZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvdWkvY29yZS92aWV3XCI7XG5pbXBvcnQgeyBHcmlkTGF5b3V0IH0gZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvdWkvbGF5b3V0cy9ncmlkLWxheW91dFwiO1xuaW1wb3J0IHsgU3dpcGVHZXN0dXJlRXZlbnREYXRhIH0gZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvdWkvZ2VzdHVyZXNcIjtcbmltcG9ydCB7IGRhdGVQcm9wZXJ0eSB9IGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL3VpL2RhdGUtcGlja2VyL2RhdGUtcGlja2VyXCI7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiBcIlVwZGF0ZVwiLFxuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgdGVtcGxhdGVVcmw6IFwiLi91cGRhdGUuY29tcG9uZW50Lmh0bWxcIlxufSlcbmV4cG9ydCBjbGFzcyBVcGRhdGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gICAgaW5mb01ldHJvOiBBcnJheTxPYmplY3Q+ID0gW107XG4gICAgZGI6IGFueTtcbiAgICBkYXRlT2ZQdXJjaGFzZTogRGF0ZTtcbiAgICB0b3RhbF9hbW91bnQ6IG51bWJlcjtcbiAgICBleHBpcmF0aW9uOiBEYXRlO1xuICAgIHVzZXJfaWQ6IHN0cmluZztcbiAgICB0eXBlOiBzdHJpbmc7XG4gICAgXG5cbiAgICBsYXlvdXRXaWR0aDogbnVtYmVyID0gNDAwO1xuICAgIGxheW91dEhlaWdodDogbnVtYmVyID0gMzAwO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgcm91dGVyRXh0ZW5zaW9uczogUm91dGVyRXh0ZW5zaW9ucyxcbiAgICAgICAgcHJpdmF0ZSB1c2VyU2VydmljZTogTG9naW5TZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGRhdGFiYXNlOiBEYXRhYmFzZVNlcnZpY2VcbiAgICApIHtcbiAgICAgICAgdGhpcy51c2VyX2lkID0gZ2V0U3RyaW5nKFwidXNlcl9pZFwiKTtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZWxlY3RDYXJkKCk7XG4gICAgfVxuXG4gICAgc2VsZWN0Q2FyZCgpe1xuICAgICAgICB0aGlzLmluZm9NZXRybyA9IFtdO1xuICAgICAgICB0aGlzLmRhdGFiYXNlLmdldGRiQ29ubmVjdGlvbigpLnRoZW4oXG4gICAgICAgICAgICBkYiA9PiB7IGRiLmFsbChcIlNFTEVDVCAqIEZST00gbWV0cm9jYXJkIFdIRVJFIHVzZXJfaWQgPSA/XCIsW3RoaXMudXNlcl9pZF0pXG4gICAgICAgIC50aGVuKCByb3dzID0+IHtcbiAgICAgICAgICAgIGZvcih2YXIgcm93IGluIHJvd3Mpe1xuICAgICAgICAgICAgICAgIHRoaXMuaW5mb01ldHJvLnB1c2goeyBpZDogcm93c1tyb3ddWzBdLCB0eXBlOiByb3dzW3Jvd11bMV0sIGRhdGU6IHJvd3Nbcm93XVsyXSwgYW1vdW50OiByb3dzW3Jvd11bM10sIGV4cGlyYXRpb246IHJvd3Nbcm93XVs0XSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZGIgPSBkYjtcbiAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNFTEVDVCBFUlJPUlwiLCBlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBvbkl0ZW1UYXAoYXJncykge1xuICAgICAgICAvL2FyZ3MuaW5kZXhcbiAgICAgICAgY29uc29sZS5sb2coYXJncy5pbmRleCk7XG4gICAgICAgIGRpYWxvZ3MuYWN0aW9uKHtcbiAgICAgICAgICAgIHRpdGxlOiBcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBVcGRhdGUgdGhpcz9cIixcbiAgICAgICAgICAgIG1lc3NhZ2U6IFwiT25jZSB1cGRhdGVkLCBpdCBjYW5ub3QgYmUgY2hhbmdlZCBcIixcbiAgICAgICAgICAgIGFjdGlvbnM6W1wiUkVNT1ZFICQyLjc1XCIsIFwiQURERUQgJDIuNzVcIiwgXCJSRU1PVkUgJDUuNTBcIiwgXCJBRERFRCAkNS41MFwiXSxcbiAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgICAgIH0pLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgXG4gICAgICAgICAgICBpZihyZXN1bHQgPT0gXCJSRU1PVkUgJDIuNzVcIil7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJVcGRhdGluZyBjYXJkXCIpO1xuICAgICAgICAgICAgICAgIC8vRGVsZXRlIENhcmQgaGVyZS5cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBsZXQgbWV0cm9jYXJkID0gPGFueT5hcmdzLnZpZXcuYmluZGluZ0NvbnRleHQ7XG4gICAgICAgICAgICAgICAgdGhpcy5kYi5leGVjU1FMKFwiVVBEQVRFIG1ldHJvY2FyZCBTRVQgdG90YWxfYW1vdW50ID0gdG90YWxfYW1vdW50LTIuNzUgV0hFUkUgaWQ9P1wiLCBbbWV0cm9jYXJkLmlkXSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICBsZXQgaW5kZXggPSB0aGlzLmluZm9NZXRyby5pbmRleE9mKG1ldHJvY2FyZCk7XG4gICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIk9iamVjdCB0aGF0IHRyaWdnZXJlZCB0aGUgZXZlbnQ6IFwiICsgYXJncy5vYmplY3QpO1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJWaWV3IHRoYXQgdHJpZ2dlcmVkIHRoZSBldmVudDogXCIgKyBhcmdzLnZpZXcpO1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJFdmVudCBuYW1lOiBcIiArIGFyZ3MuZXZlbnROYW1lKTtcbiAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5yb3V0ZXJFeHRlbnNpb25zLm5hdmlnYXRlKFtcIi9ob21lXCJdLCB7IGNsZWFySGlzdG9yeTogdHJ1ZSB9KTtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZihyZXN1bHQgPT0gXCJBRERFRCAkMi43NVwiKXtcbiAgICAgICAgICAgICAgICBsZXQgbWV0cm9jYXJkID0gPGFueT5hcmdzLnZpZXcuYmluZGluZ0NvbnRleHQ7XG4gICAgICAgICAgICAgICAgdGhpcy5kYi5leGVjU1FMKFwiVVBEQVRFIG1ldHJvY2FyZCBTRVQgdG90YWxfYW1vdW50ID0gdG90YWxfYW1vdW50KzIuNzUgV0hFUkUgaWQ9P1wiLCBbbWV0cm9jYXJkLmlkXSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICBsZXQgaW5kZXggPSB0aGlzLmluZm9NZXRyby5pbmRleE9mKG1ldHJvY2FyZCk7XG4gICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIk9iamVjdCB0aGF0IHRyaWdnZXJlZCB0aGUgZXZlbnQ6IFwiICsgYXJncy5vYmplY3QpO1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJWaWV3IHRoYXQgdHJpZ2dlcmVkIHRoZSBldmVudDogXCIgKyBhcmdzLnZpZXcpO1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJFdmVudCBuYW1lOiBcIiArIGFyZ3MuZXZlbnROYW1lKTtcbiAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5yb3V0ZXJFeHRlbnNpb25zLm5hdmlnYXRlKFtcIi9ob21lXCJdLCB7IGNsZWFySGlzdG9yeTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYocmVzdWx0ID09IFwiQURERUQgJDUuNTBcIil7XG4gICAgICAgICAgICAgICAgbGV0IG1ldHJvY2FyZCA9IDxhbnk+YXJncy52aWV3LmJpbmRpbmdDb250ZXh0O1xuICAgICAgICAgICAgICAgIHRoaXMuZGIuZXhlY1NRTChcIlVQREFURSBtZXRyb2NhcmQgU0VUIHRvdGFsX2Ftb3VudCA9IHRvdGFsX2Ftb3VudCs1LjUwIFdIRVJFIGlkPT9cIiwgW21ldHJvY2FyZC5pZF0pLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5pbmZvTWV0cm8uaW5kZXhPZihtZXRyb2NhcmQpO1xuICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJPYmplY3QgdGhhdCB0cmlnZ2VyZWQgdGhlIGV2ZW50OiBcIiArIGFyZ3Mub2JqZWN0KTtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVmlldyB0aGF0IHRyaWdnZXJlZCB0aGUgZXZlbnQ6IFwiICsgYXJncy52aWV3KTtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXZlbnQgbmFtZTogXCIgKyBhcmdzLmV2ZW50TmFtZSk7XG4gICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5yb3V0ZXJFeHRlbnNpb25zLm5hdmlnYXRlKFtcIi9ob21lXCJdLCB7IGNsZWFySGlzdG9yeTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYocmVzdWx0ID09IFwiUkVNT1ZFICQ1LjUwXCIpe1xuICAgICAgICAgICAgICAgIGxldCBtZXRyb2NhcmQgPSA8YW55PmFyZ3Mudmlldy5iaW5kaW5nQ29udGV4dDtcbiAgICAgICAgICAgICAgICB0aGlzLmRiLmV4ZWNTUUwoXCJVUERBVEUgbWV0cm9jYXJkIFNFVCB0b3RhbF9hbW91bnQgPSB0b3RhbF9hbW91bnQtNS41MCBXSEVSRSBpZD0/XCIsIFttZXRyb2NhcmQuaWRdKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgIGxldCBpbmRleCA9IHRoaXMuaW5mb01ldHJvLmluZGV4T2YobWV0cm9jYXJkKTtcbiAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiT2JqZWN0IHRoYXQgdHJpZ2dlcmVkIHRoZSBldmVudDogXCIgKyBhcmdzLm9iamVjdCk7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlZpZXcgdGhhdCB0cmlnZ2VyZWQgdGhlIGV2ZW50OiBcIiArIGFyZ3Mudmlldyk7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkV2ZW50IG5hbWU6IFwiICsgYXJncy5ldmVudE5hbWUpO1xuICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnJvdXRlckV4dGVuc2lvbnMubmF2aWdhdGUoW1wiL2hvbWVcIl0sIHsgY2xlYXJIaXN0b3J5OiB0cnVlIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgICAgIGFsZXJ0KCdOb3RoaW5nIGhhcyBjaGFuZ2VkJylcbiAgICAgICAgICAgICAgICB0aGlzLnJvdXRlckV4dGVuc2lvbnMubmF2aWdhdGUoW1wiL2hvbWVcIl0sIHsgY2xlYXJIaXN0b3J5OiB0cnVlIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgIFxuICAgICAgICB9KTtcbiAgICB9XG5cblxufVxuIl19